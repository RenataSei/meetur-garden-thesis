{"ast":null,"code":"// src/api.js\n\n// Base URL for your backend.\n// With your current setup this will be \"/api\" and CRA proxy will forward it.\nexport const API_BASE = process.env.REACT_APP_API_BASE || \"/api\";\n\n// Helper: read token from localStorage and build Authorization header\nfunction getAuthHeaders() {\n  const stored = localStorage.getItem(\"user\");\n  if (!stored) return {};\n  try {\n    const parsed = JSON.parse(stored);\n    if (!parsed || !parsed.token) {\n      return {};\n    }\n    return {\n      Authorization: `Bearer ${parsed.token}`\n    };\n  } catch (err) {\n    console.error(\"Failed to parse user from localStorage\", err);\n    return {};\n  }\n}\n\n// Common response handler\nasync function handle(res) {\n  const ct = res.headers.get(\"content-type\") || \"\";\n  if (!res.ok) {\n    if (ct.includes(\"application/json\")) {\n      const data = await res.json().catch(() => ({}));\n      const msg = (data === null || data === void 0 ? void 0 : data.error) || JSON.stringify(data) || `HTTP ${res.status}`;\n      throw new Error(msg);\n    } else {\n      const text = await res.text();\n      throw new Error(`Non JSON response (status ${res.status}): ${text.slice(0, 200)}`);\n    }\n  }\n  if (ct.includes(\"application/json\")) {\n    return res.json();\n  }\n  return res.text();\n}\n\n// ---------------------------------------------------\n// PLANTS API – all routes are protected by requireAuth\n// ---------------------------------------------------\n\nexport const PlantsAPI = {\n  // GET /api/plants\n  // Optional: accept filters as query params later\n  list: (params = {}) => {\n    const qs = new URLSearchParams(params).toString();\n    const url = qs ? `${API_BASE}/plants?${qs}` : `${API_BASE}/plants`;\n    return fetch(url, {\n      headers: {\n        ...getAuthHeaders()\n      }\n    }).then(handle).then(data => {\n      // Backend returns { count, plants }\n      if (data && Array.isArray(data.plants)) {\n        return data.plants;\n      }\n      // If backend ever changes to return a bare array, still work\n      if (Array.isArray(data)) return data;\n      return [];\n    });\n  },\n  // GET /api/plants/:id\n  get: id => fetch(`${API_BASE}/plants/${id}`, {\n    headers: {\n      ...getAuthHeaders()\n    }\n  }).then(handle),\n  // POST /api/plants\n  create: payload => fetch(`${API_BASE}/plants`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      ...getAuthHeaders()\n    },\n    body: JSON.stringify(payload)\n  }).then(handle),\n  // PATCH /api/plants/:id\n  update: (id, payload) => fetch(`${API_BASE}/plants/${id}`, {\n    method: \"PATCH\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      ...getAuthHeaders()\n    },\n    body: JSON.stringify(payload)\n  }).then(handle),\n  // DELETE /api/plants/:id\n  delete: id => fetch(`${API_BASE}/plants/${id}`, {\n    method: \"DELETE\",\n    headers: {\n      ...getAuthHeaders()\n    }\n  }).then(handle)\n};\n\n// ---------------------------------------------------\n// GENERA API (optional helper if you use it later)\n// ---------------------------------------------------\n\nexport const GeneraAPI = {\n  // GET /api/genera\n  list: () => fetch(`${API_BASE}/genera`).then(handle),\n  // GET /api/genera/:name\n  get: name => fetch(`${API_BASE}/genera/${encodeURIComponent(name)}`).then(handle)\n};\n\n// ---------------------------------------------------\n// WEATHER API (optional helper if you use it later)\n// ---------------------------------------------------\n\nexport const WeatherAPI = {\n  // GET /api/weather?city=Manila or other params\n  get: params => {\n    const queryString = new URLSearchParams(params).toString();\n    return fetch(`${API_BASE}/weather?${queryString}`).then(handle);\n  }\n};\n\n// ---------------------------------------------------\n// GARDEN API (NEW - REQUIRED FOR THESIS)\n// ---------------------------------------------------\n\nexport const GardenAPI = {\n  // GET /api/garden - List user's plants\n  list: () => fetch(`${API_BASE}/garden`, {\n    headers: {\n      ...getAuthHeaders()\n    }\n  }).then(handle),\n  // POST /api/garden - Add plant to garden\n  add: (plant_id, nickname) => fetch(`${API_BASE}/garden`, {\n    method: 'POST',\n    headers: {\n      \"Content-Type\": \"application/json\",\n      ...getAuthHeaders()\n    },\n    body: JSON.stringify({\n      plant_id,\n      nickname\n    })\n  }).then(handle),\n  // DELETE /api/garden/:id - Remove from garden\n  // Note: 'id' here is the GARDEN ITEM ID, not the Plant ID\n  remove: id => fetch(`${API_BASE}/garden/${id}`, {\n    method: 'DELETE',\n    headers: {\n      ...getAuthHeaders()\n    }\n  }).then(handle),\n  // PATCH /api/garden/:id/action - Log care (water/sun)\n  logAction: (id, action) => fetch(`${API_BASE}/garden/${id}/action`, {\n    method: 'PATCH',\n    headers: {\n      \"Content-Type\": \"application/json\",\n      ...getAuthHeaders()\n    },\n    body: JSON.stringify({\n      action\n    })\n  }).then(handle)\n};","map":{"version":3,"names":["API_BASE","process","env","REACT_APP_API_BASE","getAuthHeaders","stored","localStorage","getItem","parsed","JSON","parse","token","Authorization","err","console","error","handle","res","ct","headers","get","ok","includes","data","json","catch","msg","stringify","status","Error","text","slice","PlantsAPI","list","params","qs","URLSearchParams","toString","url","fetch","then","Array","isArray","plants","id","create","payload","method","body","update","delete","GeneraAPI","name","encodeURIComponent","WeatherAPI","queryString","GardenAPI","add","plant_id","nickname","remove","logAction","action"],"sources":["C:/Users/renee/Documents/GitHub/meetur-garden-thesis/frontend/src/api.js"],"sourcesContent":["// src/api.js\r\n\r\n// Base URL for your backend.\r\n// With your current setup this will be \"/api\" and CRA proxy will forward it.\r\nexport const API_BASE = process.env.REACT_APP_API_BASE || \"/api\";\r\n\r\n// Helper: read token from localStorage and build Authorization header\r\nfunction getAuthHeaders() {\r\n  const stored = localStorage.getItem(\"user\");\r\n  if (!stored) return {};\r\n\r\n  try {\r\n    const parsed = JSON.parse(stored);\r\n    if (!parsed || !parsed.token) {\r\n      return {};\r\n    }\r\n\r\n    return { Authorization: `Bearer ${parsed.token}` };\r\n  } catch (err) {\r\n    console.error(\"Failed to parse user from localStorage\", err);\r\n    return {};\r\n  }\r\n}\r\n\r\n// Common response handler\r\nasync function handle(res) {\r\n  const ct = res.headers.get(\"content-type\") || \"\";\r\n\r\n  if (!res.ok) {\r\n    if (ct.includes(\"application/json\")) {\r\n      const data = await res.json().catch(() => ({}));\r\n      const msg = data?.error || JSON.stringify(data) || `HTTP ${res.status}`;\r\n      throw new Error(msg);\r\n    } else {\r\n      const text = await res.text();\r\n      throw new Error(\r\n        `Non JSON response (status ${res.status}): ${text.slice(0, 200)}`\r\n      );\r\n    }\r\n  }\r\n\r\n  if (ct.includes(\"application/json\")) {\r\n    return res.json();\r\n  }\r\n\r\n  return res.text();\r\n}\r\n\r\n// ---------------------------------------------------\r\n// PLANTS API – all routes are protected by requireAuth\r\n// ---------------------------------------------------\r\n\r\nexport const PlantsAPI = {\r\n  // GET /api/plants\r\n  // Optional: accept filters as query params later\r\n  list: (params = {}) => {\r\n    const qs = new URLSearchParams(params).toString();\r\n    const url = qs ? `${API_BASE}/plants?${qs}` : `${API_BASE}/plants`;\r\n\r\n    return fetch(url, {\r\n      headers: {\r\n        ...getAuthHeaders()\r\n      }\r\n    })\r\n      .then(handle)\r\n      .then((data) => {\r\n        // Backend returns { count, plants }\r\n        if (data && Array.isArray(data.plants)) {\r\n          return data.plants;\r\n        }\r\n        // If backend ever changes to return a bare array, still work\r\n        if (Array.isArray(data)) return data;\r\n        return [];\r\n      });\r\n  },\r\n\r\n  // GET /api/plants/:id\r\n  get: (id) =>\r\n    fetch(`${API_BASE}/plants/${id}`, {\r\n      headers: {\r\n        ...getAuthHeaders()\r\n      }\r\n    }).then(handle),\r\n\r\n  // POST /api/plants\r\n  create: (payload) =>\r\n    fetch(`${API_BASE}/plants`, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        ...getAuthHeaders()\r\n      },\r\n      body: JSON.stringify(payload)\r\n    }).then(handle),\r\n\r\n  // PATCH /api/plants/:id\r\n  update: (id, payload) =>\r\n    fetch(`${API_BASE}/plants/${id}`, {\r\n      method: \"PATCH\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        ...getAuthHeaders()\r\n      },\r\n      body: JSON.stringify(payload)\r\n    }).then(handle),\r\n\r\n  // DELETE /api/plants/:id\r\n  delete: (id) =>\r\n    fetch(`${API_BASE}/plants/${id}`, {\r\n      method: \"DELETE\",\r\n      headers: {\r\n        ...getAuthHeaders()\r\n      }\r\n    }).then(handle)\r\n};\r\n\r\n// ---------------------------------------------------\r\n// GENERA API (optional helper if you use it later)\r\n// ---------------------------------------------------\r\n\r\nexport const GeneraAPI = {\r\n  // GET /api/genera\r\n  list: () => fetch(`${API_BASE}/genera`).then(handle),\r\n\r\n  // GET /api/genera/:name\r\n  get: (name) =>\r\n    fetch(`${API_BASE}/genera/${encodeURIComponent(name)}`).then(handle)\r\n};\r\n\r\n// ---------------------------------------------------\r\n// WEATHER API (optional helper if you use it later)\r\n// ---------------------------------------------------\r\n\r\nexport const WeatherAPI = {\r\n  // GET /api/weather?city=Manila or other params\r\n  get: (params) => {\r\n    const queryString = new URLSearchParams(params).toString();\r\n    return fetch(`${API_BASE}/weather?${queryString}`).then(handle);\r\n  }\r\n};\r\n\r\n// ---------------------------------------------------\r\n// GARDEN API (NEW - REQUIRED FOR THESIS)\r\n// ---------------------------------------------------\r\n\r\nexport const GardenAPI = {\r\n  // GET /api/garden - List user's plants\r\n  list: () => \r\n    fetch(`${API_BASE}/garden`, { \r\n      headers: { ...getAuthHeaders() } \r\n    }).then(handle),\r\n  \r\n  // POST /api/garden - Add plant to garden\r\n  add: (plant_id, nickname) => \r\n    fetch(`${API_BASE}/garden`, {\r\n      method: 'POST',\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        ...getAuthHeaders()\r\n      },\r\n      body: JSON.stringify({ plant_id, nickname })\r\n    }).then(handle),\r\n\r\n  // DELETE /api/garden/:id - Remove from garden\r\n  // Note: 'id' here is the GARDEN ITEM ID, not the Plant ID\r\n  remove: (id) => \r\n    fetch(`${API_BASE}/garden/${id}`, { \r\n      method: 'DELETE',\r\n      headers: { ...getAuthHeaders() } \r\n    }).then(handle),\r\n\r\n  // PATCH /api/garden/:id/action - Log care (water/sun)\r\n  logAction: (id, action) => \r\n    fetch(`${API_BASE}/garden/${id}/action`, {\r\n      method: 'PATCH',\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        ...getAuthHeaders()\r\n      },\r\n      body: JSON.stringify({ action })\r\n    }).then(handle)\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}